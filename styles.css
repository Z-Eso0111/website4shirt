document.getElementById('itemType').addEventListener('change', changeModel);
document.getElementById('imageUpload').addEventListener('change', handleImageUpload);
document.getElementById('backgroundColor').addEventListener('input', changeBackgroundColor);
document.getElementById('resetButton').addEventListener('click', resetCanvas);

function changeModel() {
    const model = document.getElementById('model');
    const itemType = document.getElementById('itemType').value;
    model.src = itemType + '.png';
}

function handleImageUpload(event) {
    const file = event.target.files[0];
    if (!file) return;

    const img = document.createElement('img');
    img.src = URL.createObjectURL(file);
    img.classList.add('draggable');
    img.onload = () => URL.revokeObjectURL(img.src); // Free memory

    img.addEventListener('mousedown', dragStart);
    img.addEventListener('mouseup', dragEnd);

    document.getElementById('canvas').appendChild(img);
}

function changeBackgroundColor(event) {
    document.getElementById('canvas').style.backgroundColor = event.target.value;
}

function resetCanvas() {
    const canvas = document.getElementById('canvas');
    canvas.innerHTML = '<img id="model" src="Shirt.png" alt="Model">';
    document.getElementById('canvas').style.backgroundColor = 'white';
}

let offsetX, offsetY, selectedElement;

function dragStart(event) {
    selectedElement = event.target;
    offsetX = event.clientX - selectedElement.offsetLeft;
    offsetY = event.clientY - selectedElement.offsetTop;
    document.addEventListener('mousemove', drag);
}

function drag(event) {
    if (selectedElement) {
        selectedElement.style.left = `${event.clientX - offsetX}px`;
        selectedElement.style.top = `${event.clientY - offsetY}px`;
    }
}

function dragEnd() {
    document.removeEventListener('mousemove', drag);
    selectedElement = null;
}
